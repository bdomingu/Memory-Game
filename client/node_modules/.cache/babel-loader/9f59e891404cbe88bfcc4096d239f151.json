{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport React, { useEffect, useLayoutEffect, useMemo, useReducer, useRef, useState } from 'react';\nimport debounce from 'lodash.debounce';\nimport throttle from 'lodash.throttle';\nimport { logChatPromiseExecution } from 'stream-chat';\nimport { nanoid } from 'nanoid';\nimport clsx from 'clsx';\nimport { channelReducer, initialState } from './channelState';\nimport { commonEmoji, defaultMinimalEmojis, emojiSetDef } from './emojiData';\nimport { useCreateChannelStateContext } from './hooks/useCreateChannelStateContext';\nimport { useCreateTypingContext } from './hooks/useCreateTypingContext';\nimport { useEditMessageHandler } from './hooks/useEditMessageHandler';\nimport { useIsMounted } from './hooks/useIsMounted';\nimport { useMentionsHandlers } from './hooks/useMentionsHandlers';\nimport { Attachment as DefaultAttachment } from '../Attachment/Attachment';\nimport { LoadingErrorIndicator as DefaultLoadingErrorIndicator } from '../Loading';\nimport { LoadingChannel as DefaultLoadingIndicator } from './LoadingChannel';\nimport { MessageSimple } from '../Message/MessageSimple';\nimport { DropzoneProvider } from '../MessageInput/DropzoneProvider';\nimport { ChannelActionProvider } from '../../context/ChannelActionContext';\nimport { ChannelStateProvider } from '../../context/ChannelStateContext';\nimport { ComponentProvider } from '../../context/ComponentContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { EmojiProvider } from '../../context/EmojiContext';\nimport { useTranslationContext } from '../../context/TranslationContext';\nimport { TypingProvider } from '../../context/TypingContext';\nimport { DEFAULT_INITIAL_CHANNEL_PAGE_SIZE, DEFAULT_NEXT_CHANNEL_PAGE_SIZE, DEFAULT_THREAD_PAGE_SIZE } from '../../constants/limits';\nimport { hasMoreMessagesProbably, hasNotMoreMessages } from '../MessageList/utils';\nimport defaultEmojiData from '../../stream-emoji.json';\nimport { makeAddNotifications } from './utils';\nimport { useChannelContainerClasses } from './hooks/useChannelContainerClasses';\n\nvar UnMemoizedChannel = function (props) {\n  var propsChannel = props.channel,\n      _a = props.EmptyPlaceholder,\n      EmptyPlaceholder = _a === void 0 ? null : _a,\n      LoadingErrorIndicator = props.LoadingErrorIndicator,\n      _b = props.LoadingIndicator,\n      LoadingIndicator = _b === void 0 ? DefaultLoadingIndicator : _b;\n\n  var _c = useChatContext('Channel'),\n      contextChannel = _c.channel,\n      channelsQueryState = _c.channelsQueryState,\n      customClasses = _c.customClasses,\n      theme = _c.theme;\n\n  var _d = useChannelContainerClasses({\n    customClasses: customClasses\n  }),\n      channelClass = _d.channelClass,\n      chatClass = _d.chatClass;\n\n  var channel = propsChannel || contextChannel;\n  var className = clsx(chatClass, theme, channelClass);\n\n  if (channelsQueryState.queryInProgress === 'reload' && LoadingIndicator) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(LoadingIndicator, null));\n  }\n\n  if (channelsQueryState.error && LoadingErrorIndicator) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(LoadingErrorIndicator, {\n      error: channelsQueryState.error\n    }));\n  }\n\n  if (!(channel === null || channel === void 0 ? void 0 : channel.cid)) {\n    return React.createElement(\"div\", {\n      className: className\n    }, EmptyPlaceholder);\n  } // @ts-ignore\n\n\n  return React.createElement(ChannelInner, __assign({}, props, {\n    channel: channel,\n    key: channel.cid\n  }));\n};\n\nvar ChannelInner = function (props) {\n  var _a;\n\n  var acceptedFiles = props.acceptedFiles,\n      activeUnreadHandler = props.activeUnreadHandler,\n      channel = props.channel,\n      children = props.children,\n      doMarkReadRequest = props.doMarkReadRequest,\n      doSendMessageRequest = props.doSendMessageRequest,\n      doUpdateMessageRequest = props.doUpdateMessageRequest,\n      _b = props.dragAndDropWindow,\n      dragAndDropWindow = _b === void 0 ? false : _b,\n      _c = props.emojiData,\n      emojiData = _c === void 0 ? defaultEmojiData : _c,\n      _d = props.LoadingErrorIndicator,\n      LoadingErrorIndicator = _d === void 0 ? DefaultLoadingErrorIndicator : _d,\n      _e = props.LoadingIndicator,\n      LoadingIndicator = _e === void 0 ? DefaultLoadingIndicator : _e,\n      maxNumberOfFiles = props.maxNumberOfFiles,\n      _f = props.multipleUploads,\n      multipleUploads = _f === void 0 ? true : _f,\n      onMentionsClick = props.onMentionsClick,\n      onMentionsHover = props.onMentionsHover,\n      _g = props.optionalMessageInputProps,\n      optionalMessageInputProps = _g === void 0 ? {} : _g,\n      skipMessageDataMemoization = props.skipMessageDataMemoization;\n\n  var _h = useChatContext('Channel'),\n      client = _h.client,\n      customClasses = _h.customClasses,\n      latestMessageDatesByChannels = _h.latestMessageDatesByChannels,\n      mutes = _h.mutes,\n      theme = _h.theme;\n\n  var t = useTranslationContext('Channel').t;\n\n  var _j = useChannelContainerClasses({\n    customClasses: customClasses\n  }),\n      channelClass = _j.channelClass,\n      chatClass = _j.chatClass,\n      chatContainerClass = _j.chatContainerClass,\n      windowsEmojiClass = _j.windowsEmojiClass;\n\n  var _k = useState(channel.getConfig()),\n      channelConfig = _k[0],\n      setChannelConfig = _k[1];\n\n  var _l = useState([]),\n      notifications = _l[0],\n      setNotifications = _l[1];\n\n  var _m = useState(),\n      quotedMessage = _m[0],\n      setQuotedMessage = _m[1];\n\n  var notificationTimeouts = [];\n\n  var _o = useReducer(channelReducer, __assign(__assign({}, initialState), {\n    loading: !channel.initialized\n  })),\n      state = _o[0],\n      dispatch = _o[1];\n\n  var isMounted = useIsMounted();\n  var originalTitle = useRef('');\n  var lastRead = useRef(new Date());\n  var online = useRef(true);\n  var channelCapabilitiesArray = (_a = channel.data) === null || _a === void 0 ? void 0 : _a.own_capabilities;\n  var emojiConfig = {\n    commonEmoji: commonEmoji,\n    defaultMinimalEmojis: defaultMinimalEmojis,\n    emojiData: emojiData,\n    emojiSetDef: emojiSetDef\n  };\n  var throttledCopyStateFromChannel = throttle(function () {\n    return dispatch({\n      channel: channel,\n      type: 'copyStateFromChannelOnEvent'\n    });\n  }, 500, {\n    leading: true,\n    trailing: true\n  });\n\n  var markRead = function () {\n    if (channel.disconnected || !(channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events)) {\n      return;\n    }\n\n    lastRead.current = new Date();\n\n    if (doMarkReadRequest) {\n      doMarkReadRequest(channel);\n    } else {\n      logChatPromiseExecution(channel.markRead(), 'mark read');\n    }\n\n    if (activeUnreadHandler) {\n      activeUnreadHandler(0, originalTitle.current);\n    } else if (originalTitle.current) {\n      document.title = originalTitle.current;\n    }\n  };\n\n  var markReadThrottled = throttle(markRead, 500, {\n    leading: true,\n    trailing: true\n  });\n\n  var handleEvent = function (event) {\n    var _a, _b, _c, _d, _e, _f, _g, _h;\n\n    if (event.message) {\n      dispatch({\n        channel: channel,\n        message: event.message,\n        type: 'updateThreadOnEvent'\n      });\n    }\n\n    if (event.type === 'user.watching.start' || event.type === 'user.watching.stop') return;\n\n    if (event.type === 'typing.start' || event.type === 'typing.stop') {\n      return dispatch({\n        channel: channel,\n        type: 'setTyping'\n      });\n    }\n\n    if (event.type === 'connection.changed' && typeof event.online === 'boolean') {\n      online.current = event.online;\n    }\n\n    if (event.type === 'message.new') {\n      var mainChannelUpdated = true;\n\n      if (((_a = event.message) === null || _a === void 0 ? void 0 : _a.parent_id) && !((_b = event.message) === null || _b === void 0 ? void 0 : _b.show_in_channel)) {\n        mainChannelUpdated = false;\n      }\n\n      if (mainChannelUpdated && ((_d = (_c = event.message) === null || _c === void 0 ? void 0 : _c.user) === null || _d === void 0 ? void 0 : _d.id) !== client.userID) {\n        if (!document.hidden) {\n          markReadThrottled();\n        } else if ((channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events) && !channel.muteStatus().muted) {\n          var unread = channel.countUnread(lastRead.current);\n\n          if (activeUnreadHandler) {\n            activeUnreadHandler(unread, originalTitle.current);\n          } else {\n            document.title = \"(\".concat(unread, \") \").concat(originalTitle.current);\n          }\n        }\n      }\n\n      if (((_f = (_e = event.message) === null || _e === void 0 ? void 0 : _e.user) === null || _f === void 0 ? void 0 : _f.id) === client.userID && ((_g = event === null || event === void 0 ? void 0 : event.message) === null || _g === void 0 ? void 0 : _g.created_at) && ((_h = event === null || event === void 0 ? void 0 : event.message) === null || _h === void 0 ? void 0 : _h.cid)) {\n        var messageDate = new Date(event.message.created_at);\n        var cid = event.message.cid;\n\n        if (!latestMessageDatesByChannels[cid] || latestMessageDatesByChannels[cid].getTime() < messageDate.getTime()) {\n          latestMessageDatesByChannels[cid] = messageDate;\n        }\n      }\n    }\n\n    throttledCopyStateFromChannel();\n  }; // useLayoutEffect here to prevent spinner. Use Suspense when it is available in stable release\n\n\n  useLayoutEffect(function () {\n    var errored = false;\n    var done = false;\n\n    var onVisibilityChange = function () {\n      if (!document.hidden) markRead();\n    };\n\n    (function () {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var config, e_1;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!!channel.initialized) return [3\n              /*break*/\n              , 4];\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n\n              return [4\n              /*yield*/\n              , channel.watch()];\n\n            case 2:\n              _a.sent();\n\n              config = channel.getConfig();\n              setChannelConfig(config);\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              e_1 = _a.sent();\n              dispatch({\n                error: e_1,\n                type: 'setError'\n              });\n              errored = true;\n              return [3\n              /*break*/\n              , 4];\n\n            case 4:\n              done = true;\n              originalTitle.current = document.title;\n\n              if (!errored) {\n                dispatch({\n                  channel: channel,\n                  type: 'initStateFromChannel'\n                });\n                if (channel.countUnread() > 0) markRead(); // The more complex sync logic is done in Chat\n\n                document.addEventListener('visibilitychange', onVisibilityChange);\n                client.on('connection.changed', handleEvent);\n                client.on('connection.recovered', handleEvent);\n                client.on('user.updated', handleEvent);\n                client.on('user.deleted', handleEvent);\n                channel.on(handleEvent);\n              }\n\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    })();\n\n    return function () {\n      if (errored || !done) return;\n      document.removeEventListener('visibilitychange', onVisibilityChange);\n      channel === null || channel === void 0 ? void 0 : channel.off(handleEvent);\n      client.off('connection.changed', handleEvent);\n      client.off('connection.recovered', handleEvent);\n      client.off('user.updated', handleEvent);\n      client.off('user.deleted', handleEvent);\n      notificationTimeouts.forEach(clearTimeout);\n    };\n  }, [channel.cid, doMarkReadRequest]);\n  useEffect(function () {\n    var _a;\n\n    if (!state.thread) return;\n    var message = (_a = state.messages) === null || _a === void 0 ? void 0 : _a.find(function (m) {\n      var _a;\n\n      return m.id === ((_a = state.thread) === null || _a === void 0 ? void 0 : _a.id);\n    });\n    if (message) dispatch({\n      message: message,\n      type: 'setThread'\n    });\n  }, [state.messages, state.thread]);\n  /** MESSAGE */\n  // Adds a temporary notification to message list, will be removed after 5 seconds\n\n  var addNotification = makeAddNotifications(setNotifications, notificationTimeouts);\n  var loadMoreFinished = debounce(function (hasMore, messages) {\n    if (!isMounted.current) return;\n    dispatch({\n      hasMore: hasMore,\n      messages: messages,\n      type: 'loadMoreFinished'\n    });\n  }, 2000, {\n    leading: true,\n    trailing: true\n  });\n\n  var loadMore = function (limit) {\n    if (limit === void 0) {\n      limit = DEFAULT_NEXT_CHANNEL_PAGE_SIZE;\n    }\n\n    return __awaiter(void 0, void 0, void 0, function () {\n      var oldestMessage, notHasMore, oldestID, perPage, queryResponse, e_2, hasMoreMessages;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!online.current || !window.navigator.onLine) return [2\n            /*return*/\n            , 0];\n            oldestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[0];\n\n            if (state.loadingMore || state.loadingMoreNewer || (oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.status) !== 'received') {\n              return [2\n              /*return*/\n              , 0];\n            }\n\n            notHasMore = hasNotMoreMessages(channel.state.messages.length, DEFAULT_INITIAL_CHANNEL_PAGE_SIZE);\n\n            if (notHasMore) {\n              loadMoreFinished(false, channel.state.messages);\n              return [2\n              /*return*/\n              , channel.state.messages.length];\n            }\n\n            dispatch({\n              loadingMore: true,\n              type: 'setLoadingMore'\n            });\n            oldestID = oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.id;\n            perPage = limit;\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n\n            return [4\n            /*yield*/\n            , channel.query({\n              messages: {\n                id_lt: oldestID,\n                limit: perPage\n              },\n              watchers: {\n                limit: perPage\n              }\n            })];\n\n          case 2:\n            queryResponse = _b.sent();\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_2 = _b.sent();\n            console.warn('message pagination request failed with error', e_2);\n            dispatch({\n              loadingMore: false,\n              type: 'setLoadingMore'\n            });\n            return [2\n            /*return*/\n            , 0];\n\n          case 4:\n            hasMoreMessages = queryResponse.messages.length === perPage;\n            loadMoreFinished(hasMoreMessages, channel.state.messages);\n            return [2\n            /*return*/\n            , queryResponse.messages.length];\n        }\n      });\n    });\n  };\n\n  var loadMoreNewer = function (limit) {\n    if (limit === void 0) {\n      limit = 100;\n    }\n\n    return __awaiter(void 0, void 0, void 0, function () {\n      var newestMessage, newestId, perPage, queryResponse, e_3, hasMoreNewer;\n\n      var _a, _b;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (!online.current || !window.navigator.onLine) return [2\n            /*return*/\n            , 0];\n            newestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[((_b = state === null || state === void 0 ? void 0 : state.messages) === null || _b === void 0 ? void 0 : _b.length) - 1];\n            if (state.loadingMore || state.loadingMoreNewer) return [2\n            /*return*/\n            , 0];\n            dispatch({\n              loadingMoreNewer: true,\n              type: 'setLoadingMoreNewer'\n            });\n            newestId = newestMessage === null || newestMessage === void 0 ? void 0 : newestMessage.id;\n            perPage = limit;\n            _c.label = 1;\n\n          case 1:\n            _c.trys.push([1, 3,, 4]);\n\n            return [4\n            /*yield*/\n            , channel.query({\n              messages: {\n                id_gt: newestId,\n                limit: perPage\n              },\n              watchers: {\n                limit: perPage\n              }\n            })];\n\n          case 2:\n            queryResponse = _c.sent();\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_3 = _c.sent();\n            console.warn('message pagination request failed with error', e_3);\n            dispatch({\n              loadingMoreNewer: false,\n              type: 'setLoadingMoreNewer'\n            });\n            return [2\n            /*return*/\n            , 0];\n\n          case 4:\n            hasMoreNewer = channel.state.messages !== channel.state.latestMessages;\n            dispatch({\n              hasMoreNewer: hasMoreNewer,\n              messages: channel.state.messages,\n              type: 'loadMoreNewerFinished'\n            });\n            return [2\n            /*return*/\n            , queryResponse.messages.length];\n        }\n      });\n    });\n  };\n\n  var clearHighlightedMessageTimeoutId = useRef(null);\n\n  var jumpToMessage = function (messageId, messageLimit) {\n    if (messageLimit === void 0) {\n      messageLimit = 100;\n    }\n\n    return __awaiter(void 0, void 0, void 0, function () {\n      var indexOfMessage, hasMoreMessages;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            dispatch({\n              loadingMore: true,\n              type: 'setLoadingMore'\n            });\n            return [4\n            /*yield*/\n            , channel.state.loadMessageIntoState(messageId, undefined, messageLimit)];\n\n          case 1:\n            _a.sent();\n\n            indexOfMessage = channel.state.messages.findIndex(function (message) {\n              return message.id === messageId;\n            });\n            hasMoreMessages = indexOfMessage >= Math.floor(messageLimit / 2);\n            loadMoreFinished(hasMoreMessages, channel.state.messages);\n            dispatch({\n              hasMoreNewer: channel.state.messages !== channel.state.latestMessages,\n              highlightedMessageId: messageId,\n              type: 'jumpToMessageFinished'\n            });\n\n            if (clearHighlightedMessageTimeoutId.current) {\n              clearTimeout(clearHighlightedMessageTimeoutId.current);\n            }\n\n            clearHighlightedMessageTimeoutId.current = setTimeout(function () {\n              clearHighlightedMessageTimeoutId.current = null;\n              dispatch({\n                type: 'clearHighlightedMessage'\n              });\n            }, 500);\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  var jumpToLatestMessage = function () {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var hasMoreOlder;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , channel.state.loadMessageIntoState('latest')];\n\n          case 1:\n            _a.sent();\n\n            hasMoreOlder = channel.state.messages.length >= 25;\n            loadMoreFinished(hasMoreOlder, channel.state.messages);\n            dispatch({\n              type: 'jumpToLatestMessage'\n            });\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  var updateMessage = function (updatedMessage) {\n    // add the message to the local channel state\n    channel.state.addMessageSorted(updatedMessage, true);\n    dispatch({\n      channel: channel,\n      parentId: state.thread && updatedMessage.parent_id,\n      type: 'copyMessagesFromChannel'\n    });\n  };\n\n  var isUserResponseArray = function (output) {\n    var _a;\n\n    return ((_a = output[0]) === null || _a === void 0 ? void 0 : _a.id) != null;\n  };\n\n  var doSendMessage = function (message, customMessageData) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var attachments, id, _a, mentioned_users, parent_id, text, mentions, messageData, messageResponse, error_1, stringError, parsedError;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            attachments = message.attachments, id = message.id, _a = message.mentioned_users, mentioned_users = _a === void 0 ? [] : _a, parent_id = message.parent_id, text = message.text;\n            mentions = isUserResponseArray(mentioned_users) ? mentioned_users.map(function (_a) {\n              var id = _a.id;\n              return id;\n            }) : mentioned_users;\n            messageData = __assign({\n              attachments: attachments,\n              id: id,\n              mentioned_users: mentions,\n              parent_id: parent_id,\n              quoted_message_id: parent_id === (quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.parent_id) ? quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.id : undefined,\n              text: text\n            }, customMessageData);\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1, 6,, 7]);\n\n            messageResponse = void 0;\n            if (!doSendMessageRequest) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , doSendMessageRequest(channel.cid, messageData)];\n\n          case 2:\n            messageResponse = _b.sent();\n            return [3\n            /*break*/\n            , 5];\n\n          case 3:\n            return [4\n            /*yield*/\n            , channel.sendMessage(messageData)];\n\n          case 4:\n            messageResponse = _b.sent();\n            _b.label = 5;\n\n          case 5:\n            // replace it after send is completed\n            if (messageResponse === null || messageResponse === void 0 ? void 0 : messageResponse.message) {\n              updateMessage(__assign(__assign({}, messageResponse.message), {\n                status: 'received'\n              }));\n            }\n\n            if (quotedMessage && parent_id === (quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.parent_id)) setQuotedMessage(undefined);\n            return [3\n            /*break*/\n            , 7];\n\n          case 6:\n            error_1 = _b.sent();\n            stringError = JSON.stringify(error_1);\n            parsedError = stringError ? JSON.parse(stringError) : {};\n            updateMessage(__assign(__assign({}, message), {\n              error: parsedError,\n              errorStatusCode: parsedError.status || undefined,\n              status: 'failed'\n            }));\n            return [3\n            /*break*/\n            , 7];\n\n          case 7:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  var sendMessage = function (_a, customMessageData) {\n    var _b = _a.attachments,\n        attachments = _b === void 0 ? [] : _b,\n        _c = _a.mentioned_users,\n        mentioned_users = _c === void 0 ? [] : _c,\n        parent = _a.parent,\n        _d = _a.text,\n        text = _d === void 0 ? '' : _d;\n    return __awaiter(void 0, void 0, void 0, function () {\n      var messagePreview;\n\n      var _e;\n\n      return __generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            channel.state.filterErrorMessages();\n            messagePreview = __assign({\n              __html: text,\n              attachments: attachments,\n              created_at: new Date(),\n              html: text,\n              id: (_e = customMessageData === null || customMessageData === void 0 ? void 0 : customMessageData.id) !== null && _e !== void 0 ? _e : \"\".concat(client.userID, \"-\").concat(nanoid()),\n              mentioned_users: mentioned_users,\n              reactions: [],\n              status: 'sending',\n              text: text,\n              type: 'regular',\n              user: client.user\n            }, (parent === null || parent === void 0 ? void 0 : parent.id) ? {\n              parent_id: parent.id\n            } : null);\n            updateMessage(messagePreview);\n            return [4\n            /*yield*/\n            , doSendMessage(messagePreview, customMessageData)];\n\n          case 1:\n            _f.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  var retrySendMessage = function (message) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            updateMessage(__assign(__assign({}, message), {\n              errorStatusCode: undefined,\n              status: 'sending'\n            }));\n            return [4\n            /*yield*/\n            , doSendMessage(message)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  var removeMessage = function (message) {\n    channel.state.removeMessage(message);\n    dispatch({\n      channel: channel,\n      parentId: state.thread && message.parent_id,\n      type: 'copyMessagesFromChannel'\n    });\n  };\n  /** THREAD */\n\n\n  var openThread = function (message, event) {\n    event.preventDefault();\n    setQuotedMessage(function (current) {\n      if ((current === null || current === void 0 ? void 0 : current.parent_id) !== (message === null || message === void 0 ? void 0 : message.parent_id)) {\n        return undefined;\n      } else {\n        return current;\n      }\n    });\n    dispatch({\n      channel: channel,\n      message: message,\n      type: 'openThread'\n    });\n  };\n\n  var closeThread = function (event) {\n    event.preventDefault();\n    dispatch({\n      type: 'closeThread'\n    });\n  };\n\n  var loadMoreThreadFinished = debounce(function (threadHasMore, threadMessages) {\n    dispatch({\n      threadHasMore: threadHasMore,\n      threadMessages: threadMessages,\n      type: 'loadMoreThreadFinished'\n    });\n  }, 2000, {\n    leading: true,\n    trailing: true\n  });\n\n  var loadMoreThread = function (limit) {\n    if (limit === void 0) {\n      limit = DEFAULT_THREAD_PAGE_SIZE;\n    }\n\n    return __awaiter(void 0, void 0, void 0, function () {\n      var parentID, oldMessages, oldestMessageID, queryResponse, threadHasMoreMessages, newThreadMessages, e_4;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (state.threadLoadingMore || !state.thread) return [2\n            /*return*/\n            ];\n            dispatch({\n              type: 'startLoadingThread'\n            });\n            parentID = state.thread.id;\n\n            if (!parentID) {\n              return [2\n              /*return*/\n              , dispatch({\n                type: 'closeThread'\n              })];\n            }\n\n            oldMessages = channel.state.threads[parentID] || [];\n            oldestMessageID = (_a = oldMessages[0]) === null || _a === void 0 ? void 0 : _a.id;\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n\n            return [4\n            /*yield*/\n            , channel.getReplies(parentID, {\n              id_lt: oldestMessageID,\n              limit: limit\n            })];\n\n          case 2:\n            queryResponse = _b.sent();\n            threadHasMoreMessages = hasMoreMessagesProbably(queryResponse.messages.length, limit);\n            newThreadMessages = channel.state.threads[parentID] || []; // next set loadingMore to false so we can start asking for more data\n\n            loadMoreThreadFinished(threadHasMoreMessages, newThreadMessages);\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_4 = _b.sent();\n            loadMoreThreadFinished(false, oldMessages);\n            return [3\n            /*break*/\n            , 4];\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  var onMentionsHoverOrClick = useMentionsHandlers(onMentionsHover, onMentionsClick);\n  var editMessage = useEditMessageHandler(doUpdateMessageRequest);\n\n  var typing = state.typing,\n      restState = __rest(state, [\"typing\"]);\n\n  var channelStateContextValue = useCreateChannelStateContext(__assign(__assign({}, restState), {\n    acceptedFiles: acceptedFiles,\n    channel: channel,\n    channelCapabilitiesArray: channelCapabilitiesArray,\n    channelConfig: channelConfig,\n    dragAndDropWindow: dragAndDropWindow,\n    giphyVersion: props.giphyVersion || 'fixed_height',\n    maxNumberOfFiles: maxNumberOfFiles,\n    multipleUploads: multipleUploads,\n    mutes: mutes,\n    notifications: notifications,\n    quotedMessage: quotedMessage,\n    watcher_count: state.watcherCount\n  }));\n  var channelActionContextValue = useMemo(function () {\n    return {\n      addNotification: addNotification,\n      closeThread: closeThread,\n      dispatch: dispatch,\n      editMessage: editMessage,\n      jumpToLatestMessage: jumpToLatestMessage,\n      jumpToMessage: jumpToMessage,\n      loadMore: loadMore,\n      loadMoreNewer: loadMoreNewer,\n      loadMoreThread: loadMoreThread,\n      onMentionsClick: onMentionsHoverOrClick,\n      onMentionsHover: onMentionsHoverOrClick,\n      openThread: openThread,\n      removeMessage: removeMessage,\n      retrySendMessage: retrySendMessage,\n      sendMessage: sendMessage,\n      setQuotedMessage: setQuotedMessage,\n      skipMessageDataMemoization: skipMessageDataMemoization,\n      updateMessage: updateMessage\n    };\n  }, [channel.cid, loadMore, loadMoreNewer, quotedMessage, jumpToMessage, jumpToLatestMessage]);\n  var componentContextValue = useMemo(function () {\n    return {\n      Attachment: props.Attachment || DefaultAttachment,\n      AutocompleteSuggestionHeader: props.AutocompleteSuggestionHeader,\n      AutocompleteSuggestionItem: props.AutocompleteSuggestionItem,\n      AutocompleteSuggestionList: props.AutocompleteSuggestionList,\n      Avatar: props.Avatar,\n      CooldownTimer: props.CooldownTimer,\n      DateSeparator: props.DateSeparator,\n      EditMessageInput: props.EditMessageInput,\n      EmojiIcon: props.EmojiIcon,\n      EmptyStateIndicator: props.EmptyStateIndicator,\n      FileUploadIcon: props.FileUploadIcon,\n      GiphyPreviewMessage: props.GiphyPreviewMessage,\n      HeaderComponent: props.HeaderComponent,\n      Input: props.Input,\n      LoadingIndicator: props.LoadingIndicator,\n      Message: props.Message || MessageSimple,\n      MessageDeleted: props.MessageDeleted,\n      MessageListNotifications: props.MessageListNotifications,\n      MessageNotification: props.MessageNotification,\n      MessageOptions: props.MessageOptions,\n      MessageRepliesCountButton: props.MessageRepliesCountButton,\n      MessageStatus: props.MessageStatus,\n      MessageSystem: props.MessageSystem,\n      MessageTimestamp: props.MessageTimestamp,\n      ModalGallery: props.ModalGallery,\n      PinIndicator: props.PinIndicator,\n      QuotedMessage: props.QuotedMessage,\n      QuotedMessagePreview: props.QuotedMessagePreview,\n      ReactionSelector: props.ReactionSelector,\n      ReactionsList: props.ReactionsList,\n      SendButton: props.SendButton,\n      ThreadHead: props.ThreadHead,\n      ThreadHeader: props.ThreadHeader,\n      ThreadStart: props.ThreadStart,\n      TriggerProvider: props.TriggerProvider,\n      TypingIndicator: props.TypingIndicator,\n      VirtualMessage: props.VirtualMessage\n    };\n  }, []);\n  var emojiContextValue = useMemo(function () {\n    return {\n      Emoji: props.Emoji,\n      emojiConfig: emojiConfig,\n      EmojiIndex: props.EmojiIndex,\n      EmojiPicker: props.EmojiPicker\n    };\n  }, []);\n  var typingContextValue = useCreateTypingContext({\n    typing: typing\n  });\n  var OptionalMessageInputProvider = useMemo(function () {\n    return dragAndDropWindow ? DropzoneProvider : React.Fragment;\n  }, [dragAndDropWindow]);\n  var className = clsx(chatClass, theme, channelClass);\n\n  if (state.error) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(LoadingErrorIndicator, {\n      error: state.error\n    }));\n  }\n\n  if (state.loading) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(LoadingIndicator, null));\n  }\n\n  if (!channel.watch) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(\"div\", null, t('Channel Missing')));\n  }\n\n  return React.createElement(\"div\", {\n    className: clsx(className, windowsEmojiClass)\n  }, React.createElement(ChannelStateProvider, {\n    value: channelStateContextValue\n  }, React.createElement(ChannelActionProvider, {\n    value: channelActionContextValue\n  }, React.createElement(ComponentProvider, {\n    value: componentContextValue\n  }, React.createElement(EmojiProvider, {\n    value: emojiContextValue\n  }, React.createElement(TypingProvider, {\n    value: typingContextValue\n  }, React.createElement(\"div\", {\n    className: \"\".concat(chatContainerClass)\n  }, React.createElement(OptionalMessageInputProvider, __assign({}, optionalMessageInputProps), children))))))));\n};\n/**\n * A wrapper component that provides channel data and renders children.\n * The Channel component provides the following contexts:\n * - [ChannelStateContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_state_context/)\n * - [ChannelActionContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_action_context/)\n * - [ComponentContext](https://getstream.io/chat/docs/sdk/react/contexts/component_context/)\n * - [EmojiContext](https://getstream.io/chat/docs/sdk/react/contexts/emoji_context/)\n * - [TypingContext](https://getstream.io/chat/docs/sdk/react/contexts/typing_context/)\n */\n\n\nexport var Channel = React.memo(UnMemoizedChannel);","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__rest","indexOf","getOwnPropertySymbols","propertyIsEnumerable","React","useEffect","useLayoutEffect","useMemo","useReducer","useRef","useState","debounce","throttle","logChatPromiseExecution","nanoid","clsx","channelReducer","initialState","commonEmoji","defaultMinimalEmojis","emojiSetDef","useCreateChannelStateContext","useCreateTypingContext","useEditMessageHandler","useIsMounted","useMentionsHandlers","Attachment","DefaultAttachment","LoadingErrorIndicator","DefaultLoadingErrorIndicator","LoadingChannel","DefaultLoadingIndicator","MessageSimple","DropzoneProvider","ChannelActionProvider","ChannelStateProvider","ComponentProvider","useChatContext","EmojiProvider","useTranslationContext","TypingProvider","DEFAULT_INITIAL_CHANNEL_PAGE_SIZE","DEFAULT_NEXT_CHANNEL_PAGE_SIZE","DEFAULT_THREAD_PAGE_SIZE","hasMoreMessagesProbably","hasNotMoreMessages","defaultEmojiData","makeAddNotifications","useChannelContainerClasses","UnMemoizedChannel","props","propsChannel","channel","_a","EmptyPlaceholder","_b","LoadingIndicator","_c","contextChannel","channelsQueryState","customClasses","theme","_d","channelClass","chatClass","className","queryInProgress","createElement","error","cid","ChannelInner","key","acceptedFiles","activeUnreadHandler","children","doMarkReadRequest","doSendMessageRequest","doUpdateMessageRequest","dragAndDropWindow","emojiData","_e","maxNumberOfFiles","_f","multipleUploads","onMentionsClick","onMentionsHover","_g","optionalMessageInputProps","skipMessageDataMemoization","_h","client","latestMessageDatesByChannels","mutes","_j","chatContainerClass","windowsEmojiClass","_k","getConfig","channelConfig","setChannelConfig","_l","notifications","setNotifications","_m","quotedMessage","setQuotedMessage","notificationTimeouts","_o","loading","initialized","state","dispatch","isMounted","originalTitle","lastRead","Date","online","channelCapabilitiesArray","data","own_capabilities","emojiConfig","throttledCopyStateFromChannel","type","leading","trailing","markRead","disconnected","read_events","current","document","title","markReadThrottled","handleEvent","event","message","mainChannelUpdated","parent_id","show_in_channel","user","id","userID","hidden","muteStatus","muted","unread","countUnread","concat","created_at","messageDate","getTime","errored","onVisibilityChange","config","e_1","watch","addEventListener","on","removeEventListener","off","forEach","clearTimeout","thread","messages","find","m","addNotification","loadMoreFinished","hasMore","loadMore","limit","oldestMessage","notHasMore","oldestID","perPage","queryResponse","e_2","hasMoreMessages","window","navigator","onLine","loadingMore","loadingMoreNewer","status","query","id_lt","watchers","console","warn","loadMoreNewer","newestMessage","newestId","e_3","hasMoreNewer","id_gt","latestMessages","clearHighlightedMessageTimeoutId","jumpToMessage","messageId","messageLimit","indexOfMessage","loadMessageIntoState","undefined","findIndex","Math","floor","highlightedMessageId","setTimeout","jumpToLatestMessage","hasMoreOlder","updateMessage","updatedMessage","addMessageSorted","parentId","isUserResponseArray","output","doSendMessage","customMessageData","attachments","mentioned_users","text","mentions","messageData","messageResponse","error_1","stringError","parsedError","map","quoted_message_id","sendMessage","JSON","stringify","parse","errorStatusCode","parent","messagePreview","filterErrorMessages","__html","html","reactions","retrySendMessage","removeMessage","openThread","preventDefault","closeThread","loadMoreThreadFinished","threadHasMore","threadMessages","loadMoreThread","parentID","oldMessages","oldestMessageID","threadHasMoreMessages","newThreadMessages","e_4","threadLoadingMore","threads","getReplies","onMentionsHoverOrClick","editMessage","typing","restState","channelStateContextValue","giphyVersion","watcher_count","watcherCount","channelActionContextValue","componentContextValue","AutocompleteSuggestionHeader","AutocompleteSuggestionItem","AutocompleteSuggestionList","Avatar","CooldownTimer","DateSeparator","EditMessageInput","EmojiIcon","EmptyStateIndicator","FileUploadIcon","GiphyPreviewMessage","HeaderComponent","Input","Message","MessageDeleted","MessageListNotifications","MessageNotification","MessageOptions","MessageRepliesCountButton","MessageStatus","MessageSystem","MessageTimestamp","ModalGallery","PinIndicator","QuotedMessage","QuotedMessagePreview","ReactionSelector","ReactionsList","SendButton","ThreadHead","ThreadHeader","ThreadStart","TriggerProvider","TypingIndicator","VirtualMessage","emojiContextValue","Emoji","EmojiIndex","EmojiPicker","typingContextValue","OptionalMessageInputProvider","Fragment","Channel","memo"],"sources":["/home/betty/web-app-practice/memory-game/client/node_modules/stream-chat-react/dist/components/Channel/Channel.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React, { useEffect, useLayoutEffect, useMemo, useReducer, useRef, useState, } from 'react';\nimport debounce from 'lodash.debounce';\nimport throttle from 'lodash.throttle';\nimport { logChatPromiseExecution, } from 'stream-chat';\nimport { nanoid } from 'nanoid';\nimport clsx from 'clsx';\nimport { channelReducer, initialState } from './channelState';\nimport { commonEmoji, defaultMinimalEmojis, emojiSetDef } from './emojiData';\nimport { useCreateChannelStateContext } from './hooks/useCreateChannelStateContext';\nimport { useCreateTypingContext } from './hooks/useCreateTypingContext';\nimport { useEditMessageHandler } from './hooks/useEditMessageHandler';\nimport { useIsMounted } from './hooks/useIsMounted';\nimport { useMentionsHandlers } from './hooks/useMentionsHandlers';\nimport { Attachment as DefaultAttachment } from '../Attachment/Attachment';\nimport { LoadingErrorIndicator as DefaultLoadingErrorIndicator, } from '../Loading';\nimport { LoadingChannel as DefaultLoadingIndicator } from './LoadingChannel';\nimport { MessageSimple } from '../Message/MessageSimple';\nimport { DropzoneProvider } from '../MessageInput/DropzoneProvider';\nimport { ChannelActionProvider, } from '../../context/ChannelActionContext';\nimport { ChannelStateProvider, } from '../../context/ChannelStateContext';\nimport { ComponentProvider } from '../../context/ComponentContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { EmojiProvider } from '../../context/EmojiContext';\nimport { useTranslationContext } from '../../context/TranslationContext';\nimport { TypingProvider } from '../../context/TypingContext';\nimport { DEFAULT_INITIAL_CHANNEL_PAGE_SIZE, DEFAULT_NEXT_CHANNEL_PAGE_SIZE, DEFAULT_THREAD_PAGE_SIZE, } from '../../constants/limits';\nimport { hasMoreMessagesProbably, hasNotMoreMessages } from '../MessageList/utils';\nimport defaultEmojiData from '../../stream-emoji.json';\nimport { makeAddNotifications } from './utils';\nimport { useChannelContainerClasses } from './hooks/useChannelContainerClasses';\nvar UnMemoizedChannel = function (props) {\n    var propsChannel = props.channel, _a = props.EmptyPlaceholder, EmptyPlaceholder = _a === void 0 ? null : _a, LoadingErrorIndicator = props.LoadingErrorIndicator, _b = props.LoadingIndicator, LoadingIndicator = _b === void 0 ? DefaultLoadingIndicator : _b;\n    var _c = useChatContext('Channel'), contextChannel = _c.channel, channelsQueryState = _c.channelsQueryState, customClasses = _c.customClasses, theme = _c.theme;\n    var _d = useChannelContainerClasses({\n        customClasses: customClasses,\n    }), channelClass = _d.channelClass, chatClass = _d.chatClass;\n    var channel = propsChannel || contextChannel;\n    var className = clsx(chatClass, theme, channelClass);\n    if (channelsQueryState.queryInProgress === 'reload' && LoadingIndicator) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(LoadingIndicator, null)));\n    }\n    if (channelsQueryState.error && LoadingErrorIndicator) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(LoadingErrorIndicator, { error: channelsQueryState.error })));\n    }\n    if (!(channel === null || channel === void 0 ? void 0 : channel.cid)) {\n        return React.createElement(\"div\", { className: className }, EmptyPlaceholder);\n    }\n    // @ts-ignore\n    return React.createElement(ChannelInner, __assign({}, props, { channel: channel, key: channel.cid }));\n};\nvar ChannelInner = function (props) {\n    var _a;\n    var acceptedFiles = props.acceptedFiles, activeUnreadHandler = props.activeUnreadHandler, channel = props.channel, children = props.children, doMarkReadRequest = props.doMarkReadRequest, doSendMessageRequest = props.doSendMessageRequest, doUpdateMessageRequest = props.doUpdateMessageRequest, _b = props.dragAndDropWindow, dragAndDropWindow = _b === void 0 ? false : _b, _c = props.emojiData, emojiData = _c === void 0 ? defaultEmojiData : _c, _d = props.LoadingErrorIndicator, LoadingErrorIndicator = _d === void 0 ? DefaultLoadingErrorIndicator : _d, _e = props.LoadingIndicator, LoadingIndicator = _e === void 0 ? DefaultLoadingIndicator : _e, maxNumberOfFiles = props.maxNumberOfFiles, _f = props.multipleUploads, multipleUploads = _f === void 0 ? true : _f, onMentionsClick = props.onMentionsClick, onMentionsHover = props.onMentionsHover, _g = props.optionalMessageInputProps, optionalMessageInputProps = _g === void 0 ? {} : _g, skipMessageDataMemoization = props.skipMessageDataMemoization;\n    var _h = useChatContext('Channel'), client = _h.client, customClasses = _h.customClasses, latestMessageDatesByChannels = _h.latestMessageDatesByChannels, mutes = _h.mutes, theme = _h.theme;\n    var t = useTranslationContext('Channel').t;\n    var _j = useChannelContainerClasses({ customClasses: customClasses }), channelClass = _j.channelClass, chatClass = _j.chatClass, chatContainerClass = _j.chatContainerClass, windowsEmojiClass = _j.windowsEmojiClass;\n    var _k = useState(channel.getConfig()), channelConfig = _k[0], setChannelConfig = _k[1];\n    var _l = useState([]), notifications = _l[0], setNotifications = _l[1];\n    var _m = useState(), quotedMessage = _m[0], setQuotedMessage = _m[1];\n    var notificationTimeouts = [];\n    var _o = useReducer(channelReducer, __assign(__assign({}, initialState), { loading: !channel.initialized })), state = _o[0], dispatch = _o[1];\n    var isMounted = useIsMounted();\n    var originalTitle = useRef('');\n    var lastRead = useRef(new Date());\n    var online = useRef(true);\n    var channelCapabilitiesArray = (_a = channel.data) === null || _a === void 0 ? void 0 : _a.own_capabilities;\n    var emojiConfig = {\n        commonEmoji: commonEmoji,\n        defaultMinimalEmojis: defaultMinimalEmojis,\n        emojiData: emojiData,\n        emojiSetDef: emojiSetDef,\n    };\n    var throttledCopyStateFromChannel = throttle(function () { return dispatch({ channel: channel, type: 'copyStateFromChannelOnEvent' }); }, 500, {\n        leading: true,\n        trailing: true,\n    });\n    var markRead = function () {\n        if (channel.disconnected || !(channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events)) {\n            return;\n        }\n        lastRead.current = new Date();\n        if (doMarkReadRequest) {\n            doMarkReadRequest(channel);\n        }\n        else {\n            logChatPromiseExecution(channel.markRead(), 'mark read');\n        }\n        if (activeUnreadHandler) {\n            activeUnreadHandler(0, originalTitle.current);\n        }\n        else if (originalTitle.current) {\n            document.title = originalTitle.current;\n        }\n    };\n    var markReadThrottled = throttle(markRead, 500, { leading: true, trailing: true });\n    var handleEvent = function (event) {\n        var _a, _b, _c, _d, _e, _f, _g, _h;\n        if (event.message) {\n            dispatch({\n                channel: channel,\n                message: event.message,\n                type: 'updateThreadOnEvent',\n            });\n        }\n        if (event.type === 'user.watching.start' || event.type === 'user.watching.stop')\n            return;\n        if (event.type === 'typing.start' || event.type === 'typing.stop') {\n            return dispatch({ channel: channel, type: 'setTyping' });\n        }\n        if (event.type === 'connection.changed' && typeof event.online === 'boolean') {\n            online.current = event.online;\n        }\n        if (event.type === 'message.new') {\n            var mainChannelUpdated = true;\n            if (((_a = event.message) === null || _a === void 0 ? void 0 : _a.parent_id) && !((_b = event.message) === null || _b === void 0 ? void 0 : _b.show_in_channel)) {\n                mainChannelUpdated = false;\n            }\n            if (mainChannelUpdated && ((_d = (_c = event.message) === null || _c === void 0 ? void 0 : _c.user) === null || _d === void 0 ? void 0 : _d.id) !== client.userID) {\n                if (!document.hidden) {\n                    markReadThrottled();\n                }\n                else if ((channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events) && !channel.muteStatus().muted) {\n                    var unread = channel.countUnread(lastRead.current);\n                    if (activeUnreadHandler) {\n                        activeUnreadHandler(unread, originalTitle.current);\n                    }\n                    else {\n                        document.title = \"(\".concat(unread, \") \").concat(originalTitle.current);\n                    }\n                }\n            }\n            if (((_f = (_e = event.message) === null || _e === void 0 ? void 0 : _e.user) === null || _f === void 0 ? void 0 : _f.id) === client.userID &&\n                ((_g = event === null || event === void 0 ? void 0 : event.message) === null || _g === void 0 ? void 0 : _g.created_at) &&\n                ((_h = event === null || event === void 0 ? void 0 : event.message) === null || _h === void 0 ? void 0 : _h.cid)) {\n                var messageDate = new Date(event.message.created_at);\n                var cid = event.message.cid;\n                if (!latestMessageDatesByChannels[cid] ||\n                    latestMessageDatesByChannels[cid].getTime() < messageDate.getTime()) {\n                    latestMessageDatesByChannels[cid] = messageDate;\n                }\n            }\n        }\n        throttledCopyStateFromChannel();\n    };\n    // useLayoutEffect here to prevent spinner. Use Suspense when it is available in stable release\n    useLayoutEffect(function () {\n        var errored = false;\n        var done = false;\n        var onVisibilityChange = function () {\n            if (!document.hidden)\n                markRead();\n        };\n        (function () { return __awaiter(void 0, void 0, void 0, function () {\n            var config, e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!!channel.initialized) return [3 /*break*/, 4];\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, channel.watch()];\n                    case 2:\n                        _a.sent();\n                        config = channel.getConfig();\n                        setChannelConfig(config);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_1 = _a.sent();\n                        dispatch({ error: e_1, type: 'setError' });\n                        errored = true;\n                        return [3 /*break*/, 4];\n                    case 4:\n                        done = true;\n                        originalTitle.current = document.title;\n                        if (!errored) {\n                            dispatch({ channel: channel, type: 'initStateFromChannel' });\n                            if (channel.countUnread() > 0)\n                                markRead();\n                            // The more complex sync logic is done in Chat\n                            document.addEventListener('visibilitychange', onVisibilityChange);\n                            client.on('connection.changed', handleEvent);\n                            client.on('connection.recovered', handleEvent);\n                            client.on('user.updated', handleEvent);\n                            client.on('user.deleted', handleEvent);\n                            channel.on(handleEvent);\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        }); })();\n        return function () {\n            if (errored || !done)\n                return;\n            document.removeEventListener('visibilitychange', onVisibilityChange);\n            channel === null || channel === void 0 ? void 0 : channel.off(handleEvent);\n            client.off('connection.changed', handleEvent);\n            client.off('connection.recovered', handleEvent);\n            client.off('user.updated', handleEvent);\n            client.off('user.deleted', handleEvent);\n            notificationTimeouts.forEach(clearTimeout);\n        };\n    }, [channel.cid, doMarkReadRequest]);\n    useEffect(function () {\n        var _a;\n        if (!state.thread)\n            return;\n        var message = (_a = state.messages) === null || _a === void 0 ? void 0 : _a.find(function (m) { var _a; return m.id === ((_a = state.thread) === null || _a === void 0 ? void 0 : _a.id); });\n        if (message)\n            dispatch({ message: message, type: 'setThread' });\n    }, [state.messages, state.thread]);\n    /** MESSAGE */\n    // Adds a temporary notification to message list, will be removed after 5 seconds\n    var addNotification = makeAddNotifications(setNotifications, notificationTimeouts);\n    var loadMoreFinished = debounce(function (hasMore, messages) {\n        if (!isMounted.current)\n            return;\n        dispatch({ hasMore: hasMore, messages: messages, type: 'loadMoreFinished' });\n    }, 2000, {\n        leading: true,\n        trailing: true,\n    });\n    var loadMore = function (limit) {\n        if (limit === void 0) { limit = DEFAULT_NEXT_CHANNEL_PAGE_SIZE; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var oldestMessage, notHasMore, oldestID, perPage, queryResponse, e_2, hasMoreMessages;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!online.current || !window.navigator.onLine)\n                            return [2 /*return*/, 0];\n                        oldestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[0];\n                        if (state.loadingMore || state.loadingMoreNewer || (oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.status) !== 'received') {\n                            return [2 /*return*/, 0];\n                        }\n                        notHasMore = hasNotMoreMessages(channel.state.messages.length, DEFAULT_INITIAL_CHANNEL_PAGE_SIZE);\n                        if (notHasMore) {\n                            loadMoreFinished(false, channel.state.messages);\n                            return [2 /*return*/, channel.state.messages.length];\n                        }\n                        dispatch({ loadingMore: true, type: 'setLoadingMore' });\n                        oldestID = oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.id;\n                        perPage = limit;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, channel.query({\n                                messages: { id_lt: oldestID, limit: perPage },\n                                watchers: { limit: perPage },\n                            })];\n                    case 2:\n                        queryResponse = _b.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_2 = _b.sent();\n                        console.warn('message pagination request failed with error', e_2);\n                        dispatch({ loadingMore: false, type: 'setLoadingMore' });\n                        return [2 /*return*/, 0];\n                    case 4:\n                        hasMoreMessages = queryResponse.messages.length === perPage;\n                        loadMoreFinished(hasMoreMessages, channel.state.messages);\n                        return [2 /*return*/, queryResponse.messages.length];\n                }\n            });\n        });\n    };\n    var loadMoreNewer = function (limit) {\n        if (limit === void 0) { limit = 100; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var newestMessage, newestId, perPage, queryResponse, e_3, hasMoreNewer;\n            var _a, _b;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (!online.current || !window.navigator.onLine)\n                            return [2 /*return*/, 0];\n                        newestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[((_b = state === null || state === void 0 ? void 0 : state.messages) === null || _b === void 0 ? void 0 : _b.length) - 1];\n                        if (state.loadingMore || state.loadingMoreNewer)\n                            return [2 /*return*/, 0];\n                        dispatch({ loadingMoreNewer: true, type: 'setLoadingMoreNewer' });\n                        newestId = newestMessage === null || newestMessage === void 0 ? void 0 : newestMessage.id;\n                        perPage = limit;\n                        _c.label = 1;\n                    case 1:\n                        _c.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, channel.query({\n                                messages: { id_gt: newestId, limit: perPage },\n                                watchers: { limit: perPage },\n                            })];\n                    case 2:\n                        queryResponse = _c.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_3 = _c.sent();\n                        console.warn('message pagination request failed with error', e_3);\n                        dispatch({ loadingMoreNewer: false, type: 'setLoadingMoreNewer' });\n                        return [2 /*return*/, 0];\n                    case 4:\n                        hasMoreNewer = channel.state.messages !== channel.state.latestMessages;\n                        dispatch({ hasMoreNewer: hasMoreNewer, messages: channel.state.messages, type: 'loadMoreNewerFinished' });\n                        return [2 /*return*/, queryResponse.messages.length];\n                }\n            });\n        });\n    };\n    var clearHighlightedMessageTimeoutId = useRef(null);\n    var jumpToMessage = function (messageId, messageLimit) {\n        if (messageLimit === void 0) { messageLimit = 100; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var indexOfMessage, hasMoreMessages;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        dispatch({ loadingMore: true, type: 'setLoadingMore' });\n                        return [4 /*yield*/, channel.state.loadMessageIntoState(messageId, undefined, messageLimit)];\n                    case 1:\n                        _a.sent();\n                        indexOfMessage = channel.state.messages.findIndex(function (message) { return message.id === messageId; });\n                        hasMoreMessages = indexOfMessage >= Math.floor(messageLimit / 2);\n                        loadMoreFinished(hasMoreMessages, channel.state.messages);\n                        dispatch({\n                            hasMoreNewer: channel.state.messages !== channel.state.latestMessages,\n                            highlightedMessageId: messageId,\n                            type: 'jumpToMessageFinished',\n                        });\n                        if (clearHighlightedMessageTimeoutId.current) {\n                            clearTimeout(clearHighlightedMessageTimeoutId.current);\n                        }\n                        clearHighlightedMessageTimeoutId.current = setTimeout(function () {\n                            clearHighlightedMessageTimeoutId.current = null;\n                            dispatch({ type: 'clearHighlightedMessage' });\n                        }, 500);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    var jumpToLatestMessage = function () { return __awaiter(void 0, void 0, void 0, function () {\n        var hasMoreOlder;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, channel.state.loadMessageIntoState('latest')];\n                case 1:\n                    _a.sent();\n                    hasMoreOlder = channel.state.messages.length >= 25;\n                    loadMoreFinished(hasMoreOlder, channel.state.messages);\n                    dispatch({\n                        type: 'jumpToLatestMessage',\n                    });\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    var updateMessage = function (updatedMessage) {\n        // add the message to the local channel state\n        channel.state.addMessageSorted(updatedMessage, true);\n        dispatch({\n            channel: channel,\n            parentId: state.thread && updatedMessage.parent_id,\n            type: 'copyMessagesFromChannel',\n        });\n    };\n    var isUserResponseArray = function (output) { var _a; return ((_a = output[0]) === null || _a === void 0 ? void 0 : _a.id) != null; };\n    var doSendMessage = function (message, customMessageData) { return __awaiter(void 0, void 0, void 0, function () {\n        var attachments, id, _a, mentioned_users, parent_id, text, mentions, messageData, messageResponse, error_1, stringError, parsedError;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    attachments = message.attachments, id = message.id, _a = message.mentioned_users, mentioned_users = _a === void 0 ? [] : _a, parent_id = message.parent_id, text = message.text;\n                    mentions = isUserResponseArray(mentioned_users)\n                        ? mentioned_users.map(function (_a) {\n                            var id = _a.id;\n                            return id;\n                        })\n                        : mentioned_users;\n                    messageData = __assign({ attachments: attachments, id: id, mentioned_users: mentions, parent_id: parent_id, quoted_message_id: parent_id === (quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.parent_id) ? quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.id : undefined, text: text }, customMessageData);\n                    _b.label = 1;\n                case 1:\n                    _b.trys.push([1, 6, , 7]);\n                    messageResponse = void 0;\n                    if (!doSendMessageRequest) return [3 /*break*/, 3];\n                    return [4 /*yield*/, doSendMessageRequest(channel.cid, messageData)];\n                case 2:\n                    messageResponse = _b.sent();\n                    return [3 /*break*/, 5];\n                case 3: return [4 /*yield*/, channel.sendMessage(messageData)];\n                case 4:\n                    messageResponse = _b.sent();\n                    _b.label = 5;\n                case 5:\n                    // replace it after send is completed\n                    if (messageResponse === null || messageResponse === void 0 ? void 0 : messageResponse.message) {\n                        updateMessage(__assign(__assign({}, messageResponse.message), { status: 'received' }));\n                    }\n                    if (quotedMessage && parent_id === (quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.parent_id))\n                        setQuotedMessage(undefined);\n                    return [3 /*break*/, 7];\n                case 6:\n                    error_1 = _b.sent();\n                    stringError = JSON.stringify(error_1);\n                    parsedError = stringError ? JSON.parse(stringError) : {};\n                    updateMessage(__assign(__assign({}, message), { error: parsedError, errorStatusCode: parsedError.status || undefined, status: 'failed' }));\n                    return [3 /*break*/, 7];\n                case 7: return [2 /*return*/];\n            }\n        });\n    }); };\n    var sendMessage = function (_a, customMessageData) {\n        var _b = _a.attachments, attachments = _b === void 0 ? [] : _b, _c = _a.mentioned_users, mentioned_users = _c === void 0 ? [] : _c, parent = _a.parent, _d = _a.text, text = _d === void 0 ? '' : _d;\n        return __awaiter(void 0, void 0, void 0, function () {\n            var messagePreview;\n            var _e;\n            return __generator(this, function (_f) {\n                switch (_f.label) {\n                    case 0:\n                        channel.state.filterErrorMessages();\n                        messagePreview = __assign({ __html: text, attachments: attachments, created_at: new Date(), html: text, id: (_e = customMessageData === null || customMessageData === void 0 ? void 0 : customMessageData.id) !== null && _e !== void 0 ? _e : \"\".concat(client.userID, \"-\").concat(nanoid()), mentioned_users: mentioned_users, reactions: [], status: 'sending', text: text, type: 'regular', user: client.user }, ((parent === null || parent === void 0 ? void 0 : parent.id) ? { parent_id: parent.id } : null));\n                        updateMessage(messagePreview);\n                        return [4 /*yield*/, doSendMessage(messagePreview, customMessageData)];\n                    case 1:\n                        _f.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    var retrySendMessage = function (message) { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    updateMessage(__assign(__assign({}, message), { errorStatusCode: undefined, status: 'sending' }));\n                    return [4 /*yield*/, doSendMessage(message)];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    var removeMessage = function (message) {\n        channel.state.removeMessage(message);\n        dispatch({\n            channel: channel,\n            parentId: state.thread && message.parent_id,\n            type: 'copyMessagesFromChannel',\n        });\n    };\n    /** THREAD */\n    var openThread = function (message, event) {\n        event.preventDefault();\n        setQuotedMessage(function (current) {\n            if ((current === null || current === void 0 ? void 0 : current.parent_id) !== (message === null || message === void 0 ? void 0 : message.parent_id)) {\n                return undefined;\n            }\n            else {\n                return current;\n            }\n        });\n        dispatch({ channel: channel, message: message, type: 'openThread' });\n    };\n    var closeThread = function (event) {\n        event.preventDefault();\n        dispatch({ type: 'closeThread' });\n    };\n    var loadMoreThreadFinished = debounce(function (threadHasMore, threadMessages) {\n        dispatch({\n            threadHasMore: threadHasMore,\n            threadMessages: threadMessages,\n            type: 'loadMoreThreadFinished',\n        });\n    }, 2000, { leading: true, trailing: true });\n    var loadMoreThread = function (limit) {\n        if (limit === void 0) { limit = DEFAULT_THREAD_PAGE_SIZE; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var parentID, oldMessages, oldestMessageID, queryResponse, threadHasMoreMessages, newThreadMessages, e_4;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (state.threadLoadingMore || !state.thread)\n                            return [2 /*return*/];\n                        dispatch({ type: 'startLoadingThread' });\n                        parentID = state.thread.id;\n                        if (!parentID) {\n                            return [2 /*return*/, dispatch({ type: 'closeThread' })];\n                        }\n                        oldMessages = channel.state.threads[parentID] || [];\n                        oldestMessageID = (_a = oldMessages[0]) === null || _a === void 0 ? void 0 : _a.id;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, channel.getReplies(parentID, {\n                                id_lt: oldestMessageID,\n                                limit: limit,\n                            })];\n                    case 2:\n                        queryResponse = _b.sent();\n                        threadHasMoreMessages = hasMoreMessagesProbably(queryResponse.messages.length, limit);\n                        newThreadMessages = channel.state.threads[parentID] || [];\n                        // next set loadingMore to false so we can start asking for more data\n                        loadMoreThreadFinished(threadHasMoreMessages, newThreadMessages);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_4 = _b.sent();\n                        loadMoreThreadFinished(false, oldMessages);\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    var onMentionsHoverOrClick = useMentionsHandlers(onMentionsHover, onMentionsClick);\n    var editMessage = useEditMessageHandler(doUpdateMessageRequest);\n    var typing = state.typing, restState = __rest(state, [\"typing\"]);\n    var channelStateContextValue = useCreateChannelStateContext(__assign(__assign({}, restState), { acceptedFiles: acceptedFiles, channel: channel, channelCapabilitiesArray: channelCapabilitiesArray, channelConfig: channelConfig, dragAndDropWindow: dragAndDropWindow, giphyVersion: props.giphyVersion || 'fixed_height', maxNumberOfFiles: maxNumberOfFiles, multipleUploads: multipleUploads, mutes: mutes, notifications: notifications, quotedMessage: quotedMessage, watcher_count: state.watcherCount }));\n    var channelActionContextValue = useMemo(function () { return ({\n        addNotification: addNotification,\n        closeThread: closeThread,\n        dispatch: dispatch,\n        editMessage: editMessage,\n        jumpToLatestMessage: jumpToLatestMessage,\n        jumpToMessage: jumpToMessage,\n        loadMore: loadMore,\n        loadMoreNewer: loadMoreNewer,\n        loadMoreThread: loadMoreThread,\n        onMentionsClick: onMentionsHoverOrClick,\n        onMentionsHover: onMentionsHoverOrClick,\n        openThread: openThread,\n        removeMessage: removeMessage,\n        retrySendMessage: retrySendMessage,\n        sendMessage: sendMessage,\n        setQuotedMessage: setQuotedMessage,\n        skipMessageDataMemoization: skipMessageDataMemoization,\n        updateMessage: updateMessage,\n    }); }, [channel.cid, loadMore, loadMoreNewer, quotedMessage, jumpToMessage, jumpToLatestMessage]);\n    var componentContextValue = useMemo(function () { return ({\n        Attachment: props.Attachment || DefaultAttachment,\n        AutocompleteSuggestionHeader: props.AutocompleteSuggestionHeader,\n        AutocompleteSuggestionItem: props.AutocompleteSuggestionItem,\n        AutocompleteSuggestionList: props.AutocompleteSuggestionList,\n        Avatar: props.Avatar,\n        CooldownTimer: props.CooldownTimer,\n        DateSeparator: props.DateSeparator,\n        EditMessageInput: props.EditMessageInput,\n        EmojiIcon: props.EmojiIcon,\n        EmptyStateIndicator: props.EmptyStateIndicator,\n        FileUploadIcon: props.FileUploadIcon,\n        GiphyPreviewMessage: props.GiphyPreviewMessage,\n        HeaderComponent: props.HeaderComponent,\n        Input: props.Input,\n        LoadingIndicator: props.LoadingIndicator,\n        Message: props.Message || MessageSimple,\n        MessageDeleted: props.MessageDeleted,\n        MessageListNotifications: props.MessageListNotifications,\n        MessageNotification: props.MessageNotification,\n        MessageOptions: props.MessageOptions,\n        MessageRepliesCountButton: props.MessageRepliesCountButton,\n        MessageStatus: props.MessageStatus,\n        MessageSystem: props.MessageSystem,\n        MessageTimestamp: props.MessageTimestamp,\n        ModalGallery: props.ModalGallery,\n        PinIndicator: props.PinIndicator,\n        QuotedMessage: props.QuotedMessage,\n        QuotedMessagePreview: props.QuotedMessagePreview,\n        ReactionSelector: props.ReactionSelector,\n        ReactionsList: props.ReactionsList,\n        SendButton: props.SendButton,\n        ThreadHead: props.ThreadHead,\n        ThreadHeader: props.ThreadHeader,\n        ThreadStart: props.ThreadStart,\n        TriggerProvider: props.TriggerProvider,\n        TypingIndicator: props.TypingIndicator,\n        VirtualMessage: props.VirtualMessage,\n    }); }, []);\n    var emojiContextValue = useMemo(function () { return ({\n        Emoji: props.Emoji,\n        emojiConfig: emojiConfig,\n        EmojiIndex: props.EmojiIndex,\n        EmojiPicker: props.EmojiPicker,\n    }); }, []);\n    var typingContextValue = useCreateTypingContext({\n        typing: typing,\n    });\n    var OptionalMessageInputProvider = useMemo(function () { return (dragAndDropWindow ? DropzoneProvider : React.Fragment); }, [dragAndDropWindow]);\n    var className = clsx(chatClass, theme, channelClass);\n    if (state.error) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(LoadingErrorIndicator, { error: state.error })));\n    }\n    if (state.loading) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(LoadingIndicator, null)));\n    }\n    if (!channel.watch) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(\"div\", null, t('Channel Missing'))));\n    }\n    return (React.createElement(\"div\", { className: clsx(className, windowsEmojiClass) },\n        React.createElement(ChannelStateProvider, { value: channelStateContextValue },\n            React.createElement(ChannelActionProvider, { value: channelActionContextValue },\n                React.createElement(ComponentProvider, { value: componentContextValue },\n                    React.createElement(EmojiProvider, { value: emojiContextValue },\n                        React.createElement(TypingProvider, { value: typingContextValue },\n                            React.createElement(\"div\", { className: \"\".concat(chatContainerClass) },\n                                React.createElement(OptionalMessageInputProvider, __assign({}, optionalMessageInputProps), children)))))))));\n};\n/**\n * A wrapper component that provides channel data and renders children.\n * The Channel component provides the following contexts:\n * - [ChannelStateContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_state_context/)\n * - [ChannelActionContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_action_context/)\n * - [ComponentContext](https://getstream.io/chat/docs/sdk/react/contexts/component_context/)\n * - [EmojiContext](https://getstream.io/chat/docs/sdk/react/contexts/emoji_context/)\n * - [TypingContext](https://getstream.io/chat/docs/sdk/react/contexts/typing_context/)\n */\nexport var Channel = React.memo(UnMemoizedChannel);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}